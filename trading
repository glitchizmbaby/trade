local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local backpack = player:WaitForChild("Backpack")

-- ✅ Geçerli key listesi burada tutulur (gizli scriptte)
local validKeys = {
    ["abc123"] = true,
    ["mySecretKey"] = true,
    ["testkey2025"] = true
}

-- ✅ Dışarıdan verilen key kontrolü
local providedKey = getgenv().key
if not providedKey or not validKeys[providedKey] then
    warn("[❌] Geçersiz key! Script çalıştırılamadı.")
    return -- script burada durur
end

-- getgenv ile dışarıdan alınan ayarlar
local pets = getgenv().pets or {}
local playersToGift = getgenv().playersToGift or {}
local delayBetweenGifts = getgenv().giftDelay or 0.5

local function sendMultiplePetsToMultiplePlayers(petNamePatterns, targetPlayerNames)
    for _, petPattern in ipairs(petNamePatterns) do
        for _, toPlayerName in ipairs(targetPlayerNames) do
            while true do
                local petTool = nil
                for _, item in ipairs(backpack:GetChildren()) do
                    if item:IsA("Tool") and string.match(item.Name, petPattern .. "$") then
                        petTool = item
                        break
                    end
                end

                if petTool and petTool.Parent == backpack then
                    for _, tool in ipairs(character:GetChildren()) do
                        if tool:IsA("Tool") and string.match(tool.Name, petPattern .. "$") then
                            tool.Parent = backpack
                        end
                    end

                    petTool.Parent = character

                    local args = {
                        {
                            {
                                Item = petTool,
                                ToGift = toPlayerName
                            },
                            "\021"
                        }
                    }

                    ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent"):FireServer(unpack(args))

                    task.wait(delayBetweenGifts)
                else
                    break
                end
            end
        end
    end
end

-- ✅ Key geçerli, script başlatılıyor
sendMultiplePetsToMultiplePlayers(pets, playersToGift)
